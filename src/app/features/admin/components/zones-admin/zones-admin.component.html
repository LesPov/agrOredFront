<div class="user-summary-container">
    <!-- Botón para volver atrás -->
    <button type="button" class="back-btn" (click)="goBack()">
      <i class="bx bx-left-arrow-alt"></i>
    </button>
  
    <div class="card">
      <ul class="dropdown-list">
        <!-- Sección: Zona (Crear/Actualizar) -->
        <li>
          <!-- Añade [open]="!zoneExists" si quieres que esté abierto por defecto al crear y cerrado al editar -->
          <details #zoneDetails>
            <summary>{{ zoneExists ? 'Editar Zona' : 'Crear Nueva Zona' }}</summary> <!-- Título dinámico -->
            <form #zoneForm="ngForm" (ngSubmit)="createZone()">
  
              <!-- ===== SECCIÓN DE IMÁGENES CON TÍTULOS ===== -->
              <h4 class="form-section-title">Imágenes Representativas</h4>
              <div class="zone-image-preview">
                <div class="preview-item">
                  <span class="image-title">Imagen del Departamento</span>
                  <div class="icon-container">
                    <label for="cityImageInput" class="icon-label" title="Seleccionar imagen del Departamento">
                      <i class="bx bx-image-add"></i>
                    </label>
                    <input type="file" id="cityImageInput" (change)="onCityImageSelected($event)" accept="image/*" style="display: none;">
                  </div>
                  <img [src]="getCityImageUrl()" alt="Previsualización Departamento" class="img-preview">
                </div>
                <div class="preview-item">
                  <span class="image-title">Imagen del Municipio</span>
                  <div class="icon-container">
                    <label for="zoneImageInput" class="icon-label" title="Seleccionar imagen del Municipio">
                      <i class="bx bx-image-add"></i>
                    </label>
                    <input type="file" id="zoneImageInput" (change)="onZoneImageSelected($event)" accept="image/*" style="display: none;">
                  </div>
                  <img [src]="getZoneImageUrl()" alt="Previsualización Municipio" class="img-preview">
                </div>
              </div>
  
              <!-- ===== CAMPOS DE UBICACIÓN ACTUALIZADOS ===== -->
              <div class="group">
                <label class="lbl" for="departamento">Departamento <span class="required">*</span></label>
                <input type="text" id="departamento" class="input" [(ngModel)]="zoneData.departamento" name="departamento" required placeholder="Ej: Quindío">
              </div>
              <div class="group">
                <label class="lbl" for="municipio">Municipio <span class="required">*</span></label>
                <input type="text" id="municipio" class="input" [(ngModel)]="zoneData.municipio" name="municipio" required placeholder="Ej: Salento">
              </div>
              <div class="group">
                <label class="lbl" for="vereda">Vereda / Zona Específica (Opcional)</label>
                <input type="text" id="vereda" class="input" [(ngModel)]="zoneData.vereda" name="vereda" placeholder="Ej: Vereda La Nubia">
              </div>
              <!-- Los campos 'Nombre de la Zona', 'Tipo de Zona' y 'Nombre del Departamento Asociado' han sido reemplazados por los 3 de arriba. -->
              
              <!-- ===== RESTO DE CAMPOS (SIN CAMBIOS) ===== -->
              <div class="group">
                <label class="lbl" for="description">Descripción</label>
                <textarea id="description" class="input" [(ngModel)]="zoneData.description" name="description" rows="3" placeholder="Breve descripción de la zona..."></textarea>
              </div>
              <div class="group">
                <label class="lbl" for="climate">Clima</label>
                <select id="climate" class="input" [(ngModel)]="zoneData.climate" name="climate">
                  <option [ngValue]="undefined">(Opcional)</option>
                  <option value="frio">Frío</option>
                  <option value="calido">Cálido</option>
                </select>
              </div>

              <!-- --- NUEVOS CAMPOS AÑADIDOS (SIN CAMBIOS) --- -->
              <div class="group">
                <label class="lbl" for="elevation">Elevación (msnm)</label>
                <input type="number" id="elevation" class="input" [(ngModel)]="zoneData.elevation" name="elevation" placeholder="Ej: 1700 (metros sobre nivel del mar)">
              </div>
  
              <div class="group">
                <label class="lbl" for="temperature">Temperatura Promedio (°C)</label>
                <input type="number" id="temperature" class="input" [(ngModel)]="zoneData.temperature" name="temperature" step="0.1" placeholder="Ej: 18.5"> <!-- step permite decimales -->
              </div>
  
              <div class="group">
                <label class="lbl" for="about">Acerca de la Zona</label>
                <textarea id="about" class="input" [(ngModel)]="zoneData.about" name="about" rows="4" placeholder="Información adicional, historia, datos de interés..."></textarea>
              </div>
              <!-- --- FIN NUEVOS CAMPOS --- -->
  
              <!-- Video, modelo 3D y título (SIN CAMBIOS) -->
              <div class="group">
                <label class="lbl" for="videoInput">Video de la Zona (Opcional)</label>
                <input type="file" id="videoInput" (change)="onVideoSelected($event)" accept="video/mp4,video/webm,video/ogg" class="input">
                <div *ngIf="videoPreview" class="preview-container">
                  <video [src]="videoPreview" controls width="300"></video>
                  <button type="button" class="remove-file-btn" (click)="selectedVideo = null; videoPreview = null" title="Quitar video">×</button>
                </div>
              </div>
              <div class="group">
                <label class="lbl" for="modelInput">Modelo 3D (Terreno .glb/.gltf)</label>
                <input type="file" id="modelInput" (change)="onModelFileSelected($event)" accept=".glb,.gltf" class="input">
                <div *ngIf="modelFileName" class="file-info">
                  <span>Archivo: {{ modelFileName }}</span>
                  <button type="button" class="remove-file-btn" (click)="selectedModelFile = null; modelFileName = ''" title="Quitar modelo 3D">×</button>
                </div>
              </div>
              <div class="group">
                <label class="lbl" for="titleGlbInput">Título 3D (.glb/.gltf)</label>
                <input type="file" id="titleGlbInput" (change)="onTitleGlbSelected($event)" accept=".glb,.gltf" class="input">
                <div *ngIf="titleGlbFileName" class="file-info">
                  <span>Archivo: {{ titleGlbFileName }}</span>
                   <button type="button" class="remove-file-btn" (click)="selectedTitleGlb = null; titleGlbFileName = ''" title="Quitar título 3D">×</button>
                </div>
              </div>
  
              <!-- Botón de envío (SIN CAMBIOS)-->
              <button type="submit" class="btn submit-btn" [disabled]="zoneForm.invalid">
                {{ zoneExists ? 'Actualizar Zona' : 'Crear Zona' }}
              </button>
              <!-- Botón para cancelar edición (si estás editando) -->
               <button type="button" *ngIf="zoneExists" class="btn cancel-btn" (click)="loadZone()">Cancelar Cambios</button>
  
            </form>
          </details>
        </li>
        <!-- Sección: Listado de Zonas -->
        <li>
          <details open>
            <summary>Todas las Zonas</summary>
            <div class="filter-counter-container">
              <div class="filter-container">
                <button class="btn" (click)="openFilterModal()">Filtrar</button>
              </div>
              <div class="counter-container">
                <span>Total: {{ filteredZones.length }}</span>
              </div>
            </div>
            <div *ngIf="isZonesLoading" class="loading">Cargando zonas...</div>
            <div *ngIf="!isZonesLoading && zonesErrorMessage" class="error">{{ zonesErrorMessage }}</div>
            <div class="table-container">

              <!-- ===== TABLA DE RESULTADOS ACTUALIZADA ===== -->
              <table *ngIf="!isZonesLoading && filteredZones.length > 0" class="user-table">
                <thead>
                  <tr>
                    <th>Departamento</th>
                    <th>Municipio</th>
                    <th>Vereda</th>
                    <th>Clima</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let zone of filteredZones">
                    <td>{{ zone.departamento }}</td>
                    <td>{{ zone.municipio }}</td>
                    <td>{{ zone.vereda || 'N/A' }}</td>
                    <td>{{ zone.climate || 'N/A' }}</td>
                    <td>
                      <button type="button" class="btn btn-danger" (click)="deleteZone(zone)">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div *ngIf="!isZonesLoading && filteredZones.length === 0" class="no-data">
                No se encontraron zonas que coincidan con los filtros.
              </div>
            </div>
          </details>
        </li>
      </ul>
   
    </div>
  </div>